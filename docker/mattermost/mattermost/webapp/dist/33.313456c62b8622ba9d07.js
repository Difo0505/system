webpackJsonp([33],{1400:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(51),i=n(o),s=a(32),r=n(s),l=a(33),u=n(l),d=a(50),c=n(d),h=a(49),f=n(h),m=a(113),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(m),p=a(58),v=a(1740),k=n(v),b=a(1753),_=a(1921),y=n(_),E=a(43),C=n(E),O=function(e){function t(e){(0,r.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleIntegrationChange=a.handleIntegrationChange.bind(a),a.originalIncomingHook=null,a}return(0,f.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){k.default.addChangeListener(this.handleIntegrationChange),"true"===window.mm_config.EnableIncomingWebhooks&&(0,b.loadIncomingHooks)()}},{key:"componentWillUnmount",value:function(){k.default.removeChangeListener(this.handleIntegrationChange)}},{key:"handleIntegrationChange",value:function(){var e=this,t=C.default.getCurrentId();this.setState({hooks:k.default.getIncomingWebhooks(t),loading:!k.default.hasReceivedIncomingWebhooks(t)}),this.state.loading||(this.originalIncomingHook=this.state.hooks.filter(function(t){return t.id===e.props.location.query.id})[0],this.setState({displayName:this.originalIncomingHook.display_name,description:this.originalIncomingHook.description,channelId:this.originalIncomingHook.channel_id}))}},{key:"performAction",value:function(e){var t=this;this.originalIncomingHook.id&&(e.id=this.originalIncomingHook.id),g.updateIncomingHook(e,function(){p.browserHistory.push("/"+t.props.team.name+"/integrations/incoming_webhooks")},function(e){t.setState({saving:!1,serverError:e.message})})}},{key:"header",value:function(){return{id:"integrations.edit",defaultMessage:"Edit"}}},{key:"footer",value:function(){return{id:"update_incoming_webhook.update",defaultMessage:"Update"}}}]),t}(y.default);t.default=O},1424:function(e,t,a){a(0),a(0);t.__esModule=!0,t.default=function(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}},1518:function(e,t,a){e.exports=a.p+"files/1171271cb71e89919600b8c3ae1774cb.gif"},1522:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(77),i=n(o),s=a(51),r=n(s),l=a(32),u=n(l),d=a(33),c=n(d),h=a(50),f=n(h),m=a(49),g=n(m),p=a(151),v=n(p),k=a(14),b=n(k),_=function(e){function t(){return(0,u.default)(this,t),(0,f.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,g.default)(t,e),(0,c.default)(t,[{key:"render",value:function(){if(!this.props.error&&0===this.props.errors.length)return null;var e=this.props.error;if(!e){var t=!0,a=!1,n=void 0;try{for(var o,s=(0,i.default)(this.props.errors);!(t=(o=s.next()).done);t=!0){var r=o.value;r&&(e=r)}}catch(e){a=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw n}}}return e?"backstage"===this.props.type?b.default.createElement("div",{className:"pull-left has-error"},b.default.createElement("label",{className:"control-label"},e)):this.props.margin?b.default.createElement("div",{className:"form-group has-error"},b.default.createElement("label",{className:"control-label"},e)):b.default.createElement("div",{className:"col-sm-12 has-error"},b.default.createElement("label",{className:"control-label"},e)):null}}],[{key:"propTypes",get:function(){return{type:v.default.node,error:v.default.node,margin:v.default.bool,errors:v.default.arrayOf(v.default.node)}}},{key:"defaultProps",get:function(){return{error:null,errors:[]}}}]),t}(b.default.Component);t.default=_},1656:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(112),i=n(o),s=a(1424),r=n(s),l=a(51),u=n(l),d=a(32),c=n(d),h=a(33),f=n(h),m=a(50),g=n(m),p=a(49),v=n(p),k=a(151),b=n(k),_=a(14),y=n(_),E=a(1518),C=n(E),O=function(e){function t(){return(0,c.default)(this,t),(0,g.default)(this,(t.__proto__||(0,u.default)(t)).apply(this,arguments))}return(0,v.default)(t,e),(0,f.default)(t,[{key:"render",value:function(){var e=this.props,t=e.spinning,a=e.children,n=(0,r.default)(e,["spinning","children"]);return t?y.default.createElement("img",{className:"spinner-button__gif",src:C.default}):y.default.createElement("button",(0,i.default)({className:"btn btn-primary"},n),a)}}],[{key:"propTypes",get:function(){return{children:b.default.node,spinning:b.default.bool.isRequired,onClick:b.default.func}}}]),t}(y.default.Component);t.default=O},1735:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(51),i=n(o),s=a(32),r=n(s),l=a(33),u=n(l),d=a(50),c=n(d),h=a(49),f=n(h),m=a(151),g=n(m),p=a(14),v=n(p),k=function(e){function t(){return(0,r.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,f.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){var e=[];return v.default.Children.forEach(this.props.children,function(t,a){0!==a&&e.push(v.default.createElement("span",{key:"divider"+a,className:"backstage-header__divider"},v.default.createElement("i",{className:"fa fa-angle-right"}))),e.push(t)}),v.default.createElement("div",{className:"backstage-header"},v.default.createElement("h1",null,e))}}],[{key:"propTypes",get:function(){return{children:g.default.node}}}]),t}(v.default.Component);t.default=k},1740:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(278),i=n(o),s=a(51),r=n(s),l=a(32),u=n(l),d=a(33),c=n(d),h=a(50),f=n(h),m=a(49),g=n(m),p=a(26),v=n(p),k=a(10),b=n(k),_=a(67),y=n(_),E=b.default.ActionTypes,C=function(e){function t(){(0,u.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e.dispatchToken=v.default.register(e.handleEventPayload.bind(e)),e.incomingWebhooks=new i.default,e.outgoingWebhooks=new i.default,e.commands=new i.default,e.oauthApps=new i.default,e}return(0,g.default)(t,e),(0,c.default)(t,[{key:"addChangeListener",value:function(e){this.on("changed",e)}},{key:"removeChangeListener",value:function(e){this.removeListener("changed",e)}},{key:"emitChange",value:function(){this.emit("changed")}},{key:"hasReceivedIncomingWebhooks",value:function(e){return this.incomingWebhooks.has(e)}},{key:"getIncomingWebhooks",value:function(e){return this.incomingWebhooks.get(e)||[]}},{key:"setIncomingWebhooks",value:function(e,t){this.incomingWebhooks.set(e,t)}},{key:"addIncomingWebhook",value:function(e){var t=e.team_id,a=this.getIncomingWebhooks(t);a.push(e),this.setIncomingWebhooks(t,a)}},{key:"updateIncomingWebhook",value:function(e){for(var t=e.team_id,a=this.getIncomingWebhooks(t),n=0;n<a.length;n++)if(a[n].id===e.id){a[n]=e;break}this.setIncomingWebhooks(t,a)}},{key:"removeIncomingWebhook",value:function(e,t){var a=this.getIncomingWebhooks(e);a=a.filter(function(e){return e.id!==t}),this.setIncomingWebhooks(e,a)}},{key:"hasReceivedOutgoingWebhooks",value:function(e){return this.outgoingWebhooks.has(e)}},{key:"getOutgoingWebhooks",value:function(e){return this.outgoingWebhooks.get(e)||[]}},{key:"getOutgoingWebhook",value:function(e,t){return this.getOutgoingWebhooks(e).filter(function(e){return e.id===t})[0]}},{key:"setOutgoingWebhooks",value:function(e,t){this.outgoingWebhooks.set(e,t)}},{key:"addOutgoingWebhook",value:function(e){var t=e.team_id,a=this.getOutgoingWebhooks(t);a.push(e),this.setOutgoingWebhooks(t,a)}},{key:"updateOutgoingWebhook",value:function(e){for(var t=e.team_id,a=this.getOutgoingWebhooks(t),n=0;n<a.length;n++)if(a[n].id===e.id){a[n]=e;break}this.setOutgoingWebhooks(t,a)}},{key:"removeOutgoingWebhook",value:function(e,t){var a=this.getOutgoingWebhooks(e);a=a.filter(function(e){return e.id!==t}),this.setOutgoingWebhooks(e,a)}},{key:"hasReceivedCommands",value:function(e){return this.commands.has(e)}},{key:"getCommands",value:function(e){return this.commands.get(e)||[]}},{key:"getCommand",value:function(e,t){return this.getCommands(e).filter(function(e){return e.id===t})[0]}},{key:"setCommands",value:function(e,t){this.commands.set(e,t)}},{key:"addCommand",value:function(e){var t=e.team_id,a=this.getCommands(t);a.push(e),this.setCommands(t,a)}},{key:"updateCommand",value:function(e){for(var t=e.team_id,a=this.getCommands(t),n=0;n<a.length;n++)if(a[n].id===e.id){a[n]=e;break}this.setCommands(t,a)}},{key:"removeCommand",value:function(e,t){var a=this.getCommands(e);a=a.filter(function(e){return e.id!==t}),this.setCommands(e,a)}},{key:"hasReceivedOAuthApps",value:function(e){return this.oauthApps.has(e)}},{key:"getOAuthApps",value:function(e){return this.oauthApps.get(e)||[]}},{key:"setOAuthApps",value:function(e,t){this.oauthApps.set(e,t)}},{key:"addOAuthApp",value:function(e){var t=e.creator_id,a=this.getOAuthApps(t);a.push(e),this.setOAuthApps(t,a)}},{key:"removeOAuthApp",value:function(e,t){var a=this.getOAuthApps(e);a=a.filter(function(e){return e.id!==t}),this.setOAuthApps(e,a)}},{key:"handleEventPayload",value:function(e){var t=e.action;switch(t.type){case E.RECEIVED_INCOMING_WEBHOOKS:this.setIncomingWebhooks(t.teamId,t.incomingWebhooks),this.emitChange();break;case E.RECEIVED_INCOMING_WEBHOOK:this.addIncomingWebhook(t.incomingWebhook),this.emitChange();break;case E.UPDATED_INCOMING_WEBHOOK:this.updateIncomingWebhook(t.incomingWebhook),this.emitChange();break;case E.REMOVED_INCOMING_WEBHOOK:this.removeIncomingWebhook(t.teamId,t.id),this.emitChange();break;case E.RECEIVED_OUTGOING_WEBHOOKS:this.setOutgoingWebhooks(t.teamId,t.outgoingWebhooks),this.emitChange();break;case E.RECEIVED_OUTGOING_WEBHOOK:this.addOutgoingWebhook(t.outgoingWebhook),this.emitChange();break;case E.UPDATED_OUTGOING_WEBHOOK:this.updateOutgoingWebhook(t.outgoingWebhook),this.emitChange();break;case E.REMOVED_OUTGOING_WEBHOOK:this.removeOutgoingWebhook(t.teamId,t.id),this.emitChange();break;case E.RECEIVED_COMMANDS:this.setCommands(t.teamId,t.commands),this.emitChange();break;case E.RECEIVED_COMMAND:this.addCommand(t.command),this.emitChange();break;case E.UPDATED_COMMAND:this.updateCommand(t.command),this.emitChange();break;case E.REMOVED_COMMAND:this.removeCommand(t.teamId,t.id),this.emitChange();break;case E.RECEIVED_OAUTHAPPS:this.setOAuthApps(t.userId,t.oauthApps),this.emitChange();break;case E.RECEIVED_OAUTHAPP:this.addOAuthApp(t.oauthApp),this.emitChange();break;case E.REMOVED_OAUTHAPP:this.removeOAuthApp(t.userId,t.id),this.emitChange()}}}]),t}(y.default);t.default=new C},1753:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(){y.default.listIncomingHooks(function(e){f.default.handleServerAction({type:E.ActionTypes.RECEIVED_INCOMING_WEBHOOKS,teamId:g.default.getCurrentId(),incomingWebhooks:e}),i(e)},function(e){b.dispatchError(e,"listIncomingHooks")})}function i(e){for(var t={},a=0;a<e.length;a++){var n=e[a];v.default.hasProfile(n.user_id)||(t[n.user_id]=!0)}var o=(0,c.default)(t);0!==o.length&&(0,I.getProfilesByIds)(o)(N,M)}function s(){y.default.listOutgoingHooks(function(e){f.default.handleServerAction({type:E.ActionTypes.RECEIVED_OUTGOING_WEBHOOKS,teamId:g.default.getCurrentId(),outgoingWebhooks:e}),r(e)},function(e){b.dispatchError(e,"listOutgoingHooks")})}function r(e){for(var t={},a=0;a<e.length;a++){var n=e[a];v.default.hasProfile(n.creator_id)||(t[n.creator_id]=!0)}var o=(0,c.default)(t);0!==o.length&&(0,I.getProfilesByIds)(o)(N,M)}function l(){y.default.listTeamCommands(function(e){f.default.handleServerAction({type:E.ActionTypes.RECEIVED_COMMANDS,teamId:y.default.teamId,commands:e}),u(e)},function(e){b.dispatchError(e,"loadTeamCommands")})}function u(e){for(var t={},a=0;a<e.length;a++){var n=e[a];v.default.hasProfile(n.creator_id)||(t[n.creator_id]=!0)}var o=(0,c.default)(t);0!==o.length&&(0,I.getProfilesByIds)(o)(N,M)}Object.defineProperty(t,"__esModule",{value:!0});var d=a(78),c=n(d);t.loadIncomingHooks=o,t.loadOutgoingHooks=s,t.loadTeamCommands=l;var h=a(26),f=n(h),m=a(43),g=n(m),p=a(22),v=n(p),k=a(113),b=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(k),_=a(52),y=n(_),E=a(10),C=a(36),O=n(C),I=a(115),N=O.default.dispatch,M=O.default.getState},1780:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(51),i=n(o),s=a(32),r=n(s),l=a(50),u=n(l),d=a(33),c=n(d),h=a(49),f=n(h),m=a(14),g=n(m),p=a(151),v=n(p),k=a(10),b=n(k),_=a(29),y=n(_),E=a(28),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(E),O=a(201),I=function(e){function t(e){(0,r.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleChannelChange=a.handleChannelChange.bind(a),a.filterChannels=a.filterChannels.bind(a),a.state={channels:y.default.getAll().filter(a.filterChannels).sort(O.sortChannelsByDisplayName)},a}return(0,f.default)(t,e),(0,c.default)(t,null,[{key:"propTypes",get:function(){return{onChange:v.default.func,value:v.default.string,selectOpen:v.default.bool.isRequired,selectPrivate:v.default.bool.isRequired,selectDm:v.default.bool.isRequired}}},{key:"defaultProps",get:function(){return{selectOpen:!1,selectPrivate:!1,selectDm:!1}}}]),(0,c.default)(t,[{key:"componentDidMount",value:function(){y.default.addChangeListener(this.handleChannelChange)}},{key:"componentWillUnmount",value:function(){y.default.removeChangeListener(this.handleChannelChange)}},{key:"handleChannelChange",value:function(){this.setState({channels:y.default.getAll().filter(this.filterChannels).sort(O.sortChannelsByDisplayName)})}},{key:"filterChannels",value:function(e){return!!e.display_name}},{key:"render",value:function(){var e=this,t=[g.default.createElement("option",{key:"",value:""},C.localizeMessage("channel_select.placeholder","--- Select a channel ---"))];return this.state.channels.forEach(function(a){a.type===b.default.OPEN_CHANNEL&&e.props.selectOpen?t.push(g.default.createElement("option",{key:a.id,value:a.id},a.display_name)):a.type===b.default.PRIVATE_CHANNEL&&e.props.selectPrivate?t.push(g.default.createElement("option",{key:a.id,value:a.id},a.display_name)):a.type===b.default.DM_CHANNEL&&e.props.selectDm&&t.push(g.default.createElement("option",{key:a.id,value:a.id},a.display_name))}),g.default.createElement("select",{className:"form-control",value:this.props.value,onChange:this.props.onChange},t)}}]),t}(g.default.Component);t.default=I},1921:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(51),i=n(o),s=a(32),r=n(s),l=a(50),u=n(l),d=a(33),c=n(d),h=a(49),f=n(h),m=a(151),g=n(m),p=a(14),v=n(p),k=a(1735),b=n(k),_=a(1780),y=n(_),E=a(197),C=a(1522),O=n(C),I=a(1656),N=n(I),M=a(58),W=function(e){function t(e){(0,r.default)(this,t);var a=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));if(a.handleSubmit=a.handleSubmit.bind(a),a.updateDisplayName=a.updateDisplayName.bind(a),a.updateDescription=a.updateDescription.bind(a),a.updateChannelId=a.updateChannelId.bind(a),a.state={displayName:"",description:"",channelId:"",saving:!1,serverError:"",clientError:null},void 0===a.performAction)throw new TypeError("Subclasses must override performAction");if(void 0===a.header)throw new TypeError("Subclasses must override header");if(void 0===a.footer)throw new TypeError("Subclasses must override footer");return a.performAction=a.performAction.bind(a),a.header=a.header.bind(a),a.footer=a.footer.bind(a),a}return(0,f.default)(t,e),(0,c.default)(t,null,[{key:"propTypes",get:function(){return{team:g.default.object}}}]),(0,c.default)(t,[{key:"handleSubmit",value:function(e){if(e.preventDefault(),!this.state.saving){if(this.setState({saving:!0,serverError:"",clientError:""}),!this.state.channelId)return void this.setState({saving:!1,clientError:v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.channelRequired",defaultMessage:"A valid channel is required"})});var t={channel_id:this.state.channelId,display_name:this.state.displayName,description:this.state.description};this.performAction(t)}}},{key:"updateDisplayName",value:function(e){this.setState({displayName:e.target.value})}},{key:"updateDescription",value:function(e){this.setState({description:e.target.value})}},{key:"updateChannelId",value:function(e){this.setState({channelId:e.target.value})}},{key:"render",value:function(){var e=this.header(),t=this.footer();return v.default.createElement("div",{className:"backstage-content"},v.default.createElement(b.default,null,v.default.createElement(M.Link,{to:"/"+this.props.team.name+"/integrations/incoming_webhooks"},v.default.createElement(E.FormattedMessage,{id:"installed_incoming_webhooks.header",defaultMessage:"Incoming Webhooks"})),v.default.createElement(E.FormattedMessage,{id:e.id,defaultMessage:e.defaultMessage})),v.default.createElement("div",{className:"backstage-form"},v.default.createElement("form",{className:"form-horizontal",onSubmit:this.handleSubmit},v.default.createElement("div",{className:"form-group"},v.default.createElement("label",{className:"control-label col-sm-4",htmlFor:"displayName"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.displayName",defaultMessage:"Display Name"})),v.default.createElement("div",{className:"col-md-5 col-sm-8"},v.default.createElement("input",{id:"displayName",type:"text",maxLength:"64",className:"form-control",value:this.state.displayName,onChange:this.updateDisplayName}),v.default.createElement("div",{className:"form__help"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.displayName.help",defaultMessage:"Display name for your incoming webhook made of up to 64 characters."})))),v.default.createElement("div",{className:"form-group"},v.default.createElement("label",{className:"control-label col-sm-4",htmlFor:"description"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.description",defaultMessage:"Description"})),v.default.createElement("div",{className:"col-md-5 col-sm-8"},v.default.createElement("input",{id:"description",type:"text",maxLength:"128",className:"form-control",value:this.state.description,onChange:this.updateDescription}),v.default.createElement("div",{className:"form__help"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.description.help",defaultMessage:"Description for your incoming webhook."})))),v.default.createElement("div",{className:"form-group"},v.default.createElement("label",{className:"control-label col-sm-4",htmlFor:"channelId"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.channel",defaultMessage:"Channel"})),v.default.createElement("div",{className:"col-md-5 col-sm-8"},v.default.createElement(y.default,{id:"channelId",value:this.state.channelId,onChange:this.updateChannelId,selectOpen:!0,selectPrivate:!0}),v.default.createElement("div",{className:"form__help"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.channel.help",defaultMessage:"Public or private channel that receives the webhook payloads. You must belong to the private channel when setting up the webhook."})))),v.default.createElement("div",{className:"backstage-form__footer"},v.default.createElement(O.default,{type:"backstage",errors:[this.state.serverError,this.state.clientError]}),v.default.createElement(M.Link,{className:"btn btn-sm",to:"/"+this.props.team.name+"/integrations/incoming_webhooks"},v.default.createElement(E.FormattedMessage,{id:"add_incoming_webhook.cancel",defaultMessage:"Cancel"})),v.default.createElement(N.default,{className:"btn btn-primary",type:"submit",spinning:this.state.saving,onClick:this.handleSubmit},v.default.createElement(E.FormattedMessage,{id:t.id,defaultMessage:t.defaultMessage}))))))}}]),t}(v.default.Component);t.default=W}});
//# sourceMappingURL=33.313456c62b8622ba9d07.js.map