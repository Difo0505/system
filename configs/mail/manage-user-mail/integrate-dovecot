https://wiki.archlinux.org/index.php/Virtual_user_mail_system#Dovecot
https://wiki.dovecot.org/BasicConfiguration

/etc/dovecot/conf.d/10-auth.conf
```
#!include auth-sql.conf.ext
```

/etc/dovecot/conf.d/auth-sql.conf.ext
```
passdb {
  driver = sql
  # Path for SQL configuration file, see example-config/dovecot-sql.conf.ext
  args = /etc/dovecot/dovecot-sql.conf.ext
}

userdb {
  driver = sql
  args = /etc/dovecot/dovecot-sql.conf.ext
}
```

/etc/dovecot/dovecot.conf
```
...
# Protocols we want to be serving.
#protocols = imap pop3 lmtp
protocols = imap pop3
...
```

/etc/dovecot/conf.d/10-auth.conf
```
...
auth_mechanisms = plain login
...
disable_plaintext_auth = no
```

/etc/dovecot/conf.d/10-master.conf
```
service auth {
    unix_listener /var/spool/postfix/private/auth {
        mode = 0660
        user = postfix
        group = postfix
    }
    user = postfix
    group = postfix
}
```

/etc/dovecot/conf.d/10-mail.conf
```
mail_location = maildir:/var/mail/vmail/%u/
...
first_valid_uid = 9999
```

/etc/dovecot/conf.d/10-ssl.conf
Keep it as default
```
connect = host=localhost dbname=postfix user=postfix password=postfix
# Use either
driver = mysql
# Or
# driver = pgsql

# Default password scheme - change to match your Postfixadmin setting.
# depends on your $CONF['encrypt'] setting:
# md5crypt  -> MD5-CRYPT
# md5       -> PLAIN-MD5
# cleartext -> PLAIN
default_pass_scheme = MD5-CRYPT

# Query to retrieve password. user can be used to retrieve username in other
# formats also.

password_query = SELECT username AS user,password FROM mailbox WHERE username = '%u' AND active='1'

# Query to retrieve user information, note uid matches dovecot.conf AND Postfix virtual_uid_maps parameter.
user_query = SELECT maildir, 9999 AS uid, 9999 AS gid FROM mailbox WHERE username = '%u' AND active='1'


# MYSQL :
user_query = SELECT CONCAT('/var/vmail/mail/', maildir) AS home, 9999 AS uid, 9999 AS gid,
	CONCAT('*:bytes=', quota) AS quota_rule FROM mailbox WHERE username = '%u' AND active='1'
# PostgreSQL : (no Quota though) :
# user_query = SELECT '/var/vmail/mail/' || maildir AS home, 9999 as uid, 9999 as gid FROM mailbox WHERE username = '%u' AND active = '1'
```

systemctl restart dovecot
